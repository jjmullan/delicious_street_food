#!/usr/bin/env sh

# PATH ì„¤ì • (GUI í™˜ê²½ì—ì„œë„ npmì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡)
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"

# nvm ì´ˆê¸°í™” (nvm ì‚¬ìš© ì‹œ)
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# pre-push: push ì „ì— í’ˆì§ˆ ê²€ì‚¬ ì‹¤í–‰
# - TypeScript íƒ€ì… ì²´í¬
# - Biome ë¦°íŠ¸ ê²€ì‚¬
# - í…ŒìŠ¤íŠ¸ ì‹¤í–‰

# npmì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
if ! command -v npm >/dev/null 2>&1; then
  echo "âš ï¸  Warning: npm not found. Skipping pre-push checks."
  exit 0
fi

echo "\nğŸ” Pre-push ê²€ì‚¬ ì‹œì‘...\n"

# TypeScript ì»´íŒŒì¼ ì²´í¬
echo "ğŸ“˜ TypeScript íƒ€ì… ì²´í¬ ì¤‘..."
npm exec tsc -b --noEmit
if [ $? -ne 0 ]; then
  echo "\nâŒ TypeScript íƒ€ì… ì—ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤. ìˆ˜ì • í›„ ë‹¤ì‹œ push í•´ì£¼ì„¸ìš”."
  exit 1
fi

# Biome ë¦°íŠ¸ ì²´í¬
echo "ğŸ”§ Biome ë¦°íŠ¸ ê²€ì‚¬ ì¤‘..."
npm run lint
if [ $? -ne 0 ]; then
  echo "\nâŒ ë¦°íŠ¸ ì—ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤. 'npm run check:fix'ë¡œ ìë™ ìˆ˜ì • í›„ ë‹¤ì‹œ push í•´ì£¼ì„¸ìš”."
  exit 1
fi

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
npm run test --run
if [ $? -ne 0 ]; then
  echo "\nâŒ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼ì‹œí‚¨ í›„ ë‹¤ì‹œ push í•´ì£¼ì„¸ìš”."
  exit 1
fi

echo "\nâœ… ëª¨ë“  ê²€ì‚¬ë¥¼ í†µê³¼í–ˆìŠµë‹ˆë‹¤. Pushë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.\n"
exit 0
