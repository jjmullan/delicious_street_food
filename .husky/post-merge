#!/usr/bin/env sh

# PATH ì„¤ì • (GUI í™˜ê²½ì—ì„œë„ pnpmê³¼ gitì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡)
export PATH="/usr/local/bin:$HOME/.local/share/pnpm:$PATH"

# post-merge: merge í›„ ì˜ì¡´ì„±ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ìë™ ì„¤ì¹˜
# package.json ë˜ëŠ” pnpm-lock.yamlì´ ë³€ê²½ë˜ì—ˆë‹¤ë©´ pnpm install ì‹¤í–‰

# pnpmì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
if ! command -v pnpm >/dev/null 2>&1; then
  echo "âš ï¸  Warning: pnpm not found. Skipping dependency check."
  exit 0
fi

changed_files="$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD 2>/dev/null || echo "")"

check_run() {
  echo "$changed_files" | grep -q "$1" && eval "$2"
}

# package.json ë˜ëŠ” pnpm-lock.yamlì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ í™•ì¸
if echo "$changed_files" | grep -qE "package\.json|pnpm-lock\.yaml"; then
  echo "\nğŸ“¦ ì˜ì¡´ì„± íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. pnpm installì„ ì‹¤í–‰í•©ë‹ˆë‹¤...\n"
  pnpm install

  if [ $? -eq 0 ]; then
    echo "\nâœ… ì˜ì¡´ì„±ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.\n"
  else
    echo "\nâš ï¸  ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ 'pnpm install'ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.\n"
  fi
fi

exit 0
